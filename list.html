<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trait Analysis Viewer - Face Reading Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font - Using Inter, but defining a fallback for "sporty" feel */
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap');
        
        /* Custom scrollbar styling for aesthetics */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #f87171; /* red-400 */
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: #fee2e2; /* red-100 */
        }
        
        /* Style for active item in the list - Sporty Red/Black */
        .active-trait-item {
            background-color: #ef4444; /* red-500 */
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* Lifted appearance */
        }
        .active-trait-item:hover {
            background-color: #dc2626; /* red-600 */
        }

        /* Default layout: Desktop/Wide */
        .list-view, .report-view {
            display: block; /* Default to showing both panes side-by-side */
        }

        /* Mobile layout overrides: Narrow screen/Mobile view */
        @media (max-width: 768px) {
            .mobile-only { display: block !important; }
            .desktop-only { display: none !important; }

            /* By default, hide one view on mobile and show the other */
            .list-view-mobile-hidden { display: none; }
            .report-view-mobile-hidden { display: none; }
        }

        /* Utility class to show only on desktop */
        .desktop-only { display: block; }
        /* Utility class to hide on desktop (initially hidden, shown on mobile override) */
        .mobile-only { display: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800 font-[Roboto Mono]">

    <!-- Main Container: Split View for Desktop, Stacked for Mobile -->
    <div id="app-container" class="md:flex h-screen">
        
        <!-- Trait Selection List (Left Pane - Always visible on desktop) -->
        <div id="list-pane" class="list-view w-full md:w-1/2 lg:w-2/5 xl:w-1/3 bg-white p-6 shadow-2xl overflow-y-auto custom-scrollbar">
            <h1 class="text-3xl font-extrabold text-red-600 mb-2">Face Trait Analyzer</h1>
            <p class="text-sm text-gray-500 mb-6 border-b pb-4">Select the feature that best describes each area below to generate your personality profile.</p>
            
            <div id="trait-list" class="space-y-6">
                <!-- Traits will be dynamically loaded here -->
            </div>

            <div class="mt-8 pt-4 border-t border-gray-200">
                <button id="generate-report-button" class="w-full py-3 px-4 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700 transition duration-150 transform hover:scale-[1.01]">
                    Generate Profile Report
                </button>
                <p id="selection-status" class="text-xs text-red-500 mt-2 text-center hidden">
                    Please select one feature for every trait before generating the report.
                </p>
            </div>
        </div>

        <!-- Report Display (Right Pane - Always visible on desktop) -->
        <div id="report-pane" class="report-view flex-1 bg-gray-50 p-6 md:p-8 overflow-y-auto custom-scrollbar">
            
            <button id="back-button" class="mobile-only mb-4 py-2 px-4 bg-gray-200 text-gray-700 font-bold rounded-lg hover:bg-gray-300 transition duration-150">
                &larr; Back to Selection
            </button>

            <h2 class="text-2xl font-bold text-gray-700 mb-4 desktop-only">Generated Analysis Report</h2>
            <div id="report-content" class="space-y-6">
                <div class="p-6 bg-white border border-gray-200 rounded-xl shadow-md text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mx-auto text-red-500 mb-3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.254-1.353 2.825-1.353 4.475C2.75 21.087 4.713 22.5 7.125 22.5h9.75c2.412 0 4.375-1.413 4.375-3.824 0-1.65-.487-3.221-1.353-4.475m-3.719-3.417c.319.46.495 1.05.495 1.666v.75c0 .356.168.708.484.978.319.26.712.431 1.139.517a1 1 0 001.27-.478l.478-.813c.27-.457.447-1.015.516-1.613a1 1 0 00-1.298-1.22l-.462.154" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-15a7.5 7.5 0 007.5-7.5z" />
                    </svg>
                    <p class="text-gray-500">
                        Select features on the left and click "Generate Report" to see your personalized analysis.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Trait Data Definition ---
        const TRAIT_DATA = [
   {
      "name":"Nostril Shape (Financial Perspective)",
      "key":"nostril_shape",
      "description":"Select the shape and size of the nostrils (Financial Risk & Spending Habits).",
      "features":[
         {
            "name":"Large/Flared Nostrils (Generous Spender)",
            "trait":"Indicates an open nature, comfortable with risk and free spending.",
            "pros":"High potential for earning; generous and open-handed with money.",
            "cons":"Prone to impulse buying and struggling with long-term savings."
         },
         {
            "name":"Small/Hidden Nostrils (Careful Saver)",
            "trait":"Associated with cautious financial management and a practical approach to spending.",
            "pros":"Meticulous saver; builds wealth steadily and minimizes financial risk.",
            "cons":"Can be perceived as frugal or overly cautious; may miss smart investment opportunities."
         },
         {
            "name":"Round/Symmetrical Nostrils (Balanced Finance)",
            "trait":"Suggests a balanced approach to money, valuing stability.",
            "pros":"Avoids financial drama; capable of both sensible saving and necessary spending.",
            "cons":"Progress may be slow or moderate due to aversion to high risk."
         },
         {
            "name":"Asymmetrical Nostrils (Unpredictable Finance)",
            "trait":"Indicates a fluctuating or somewhat chaotic financial life.",
            "pros":"Capable of generating wealth quickly through bursts of activity.",
            "cons":"Financial stability is highly volatile; requires extreme self-discipline to maintain balance."
         }
      ]
   },
   {
      "name":"Eye Shape (Emotional Outlook & Intelligence)",
      "key":"eye_shape",
      "description":"Select the shape of the eyes (Emotional Outlook & Intelligence).",
      "features":[
         {
            "name":"Almond Shaped (Clever/Observant)",
            "trait":"Indicates a person who is clever, slightly secretive, and highly observant.",
            "pros":"Highly perceptive and analytical; magnetic and mysterious appeal.",
            "cons":"Emotionally reserved; can be perceived as guarded or difficult to read."
         },
         {
            "name":"Round/Large Eyes (Innocent/Open)",
            "trait":"Suggests a person who is emotional, expressive, and wears their heart on their sleeve.",
            "pros":"Approachable, expressive, and romantic; perceived as innocent and trustworthy.",
            "cons":"Easily swayed by emotions; prone to drama or being overly reactive."
         },
         {
            "name":"Narrow/Hooded Eyes (Analytical)",
            "trait":"Associated with a sharp, analytical mind that observes details others miss.",
            "pros":"Meticulous and focused on detail; strong critical thinking skills.",
            "cons":"Can be overly guarded or suspicious; may struggle with open emotional expression."
         },
         {
            "name":"Upturned Eyes (Ambitious/Driven)",
            "trait":"Indicates an ambitious, powerful, and highly driven personality.",
            "pros":"Seek success and respect; competitive and naturally powerful leaders.",
            "cons":"Can come across as overly intense or aggressive; driven to compete at all costs."
         },
         {
            "name":"Downturned Eyes (Empathetic/Sensitive)",
            "trait":"Suggests a deeply empathetic, kind, and nurturing nature.",
            "pros":"Highly compassionate and sensitive to others' feelings; a natural caregiver.",
            "cons":"Prone to emotional weight and self-pity; may be perceived as sad or melancholic."
         }
      ]
   },
   {
      "name":"Eye Spacing (Perspective & Attention to Detail)",
      "key":"eye_spacing",
      "description":"Select the distance between the inner corners of the eyes (Perspective & Attention to Detail).",
      "features":[
         {
            "name":"Wide-Set Eyes (Big Picture)",
            "trait":"Indicates a person who thrives on a broad perspective, flexibility, and adaptability.",
            "pros":"Highly tolerant, flexible, and sees the 'big picture' easily; natural visionaries.",
            "cons":"Struggles with restrictive details and specialized, meticulous tasks; can overlook minor errors."
         },
         {
            "name":"Close-Set Eyes (Detail Focused)",
            "trait":"Suggests a focused, intense, and highly detail-oriented mindset.",
            "pros":"Excels at specialized, meticulous tasks; prefers order and consistency.",
            "cons":"Can become easily stressed by chaos or disruption; may become overly rigid or narrowly focused."
         },
         {
            "name":"Average Spacing (Measured)",
            "trait":"Represents a balanced and measured perspective.",
            "pros":"Can transition easily between details and the overall scope; highly adaptable.",
            "cons":"May lack the extreme intensity of close-set or the broad vision of wide-set."
         }
      ]
   },
   {
      "name":"Eyebrow Curve (Decision Making & Attitude)",
      "key":"eyebrow_curve",
      "description":"Select the arch of the eyebrows (Decision Making & Attitude).",
      "features":[
         {
            "name":"High Arch (Dramatic/Artistic)",
            "trait":"Indicates a flair for drama and aesthetics; high standards.",
            "pros":"Perfectionistic with high standards; strong artistic and creative sensibility.",
            "cons":"Decisions can be emotionally driven; may be perceived as dramatic or temperamental."
         },
         {
            "name":"Straight/Flat (Logical/Linear)",
            "trait":"Suggests a very logical, practical, and linear thinker.",
            "pros":"Approaches problems directly using facts; values efficiency and logic over emotion.",
            "cons":"Can appear emotionally cold or inflexible; struggles with abstract or ambiguous concepts."
         },
         {
            "name":"Curved/Rounded (People-Oriented)",
            "trait":"Associated with a friendly, diplomatic nature.",
            "pros":"Values harmony in relationships; excellent diplomat and team player.",
            "cons":"Decisions may be compromised to maintain peace; risk of being easily influenced."
         },
         {
            "name":"Dipping/Angled (Intensity/Focus)",
            "trait":"Indicates a person who can focus intensely and has high expectations.",
            "pros":"Rapid advancement due to intense focus and high personal standards.",
            "cons":"May come across as intense or demanding; prone to high stress and burnout."
         }
      ]
   },
   {
      "name":"Dimples/Facial Marks (Emotional Expression & Fortune)",
      "key":"marks",
      "description":"Select the presence of dimples or major facial lines (Emotional Expression & Fortune).",
      "features":[
         {
            "name":"Cheek Dimples (Friendly/Charming)",
            "trait":"Symbolizes inherent optimism, a joyful personality, and strong social magnetism.",
            "pros":"Excellent rapport builder; attracts good fortune in social and public spheres.",
            "cons":"May lack deep seriousness; can sometimes rely too heavily on charm."
         },
         {
            "name":"Pronounced Laugh Lines (Warm & Experienced)",
            "trait":"Indicates an expressive, frequently happy, and warm personality.",
            "pros":"High emotional resilience; good sense of humor and life experience.",
            "cons":"Can indicate a lack of restraint in laughter or emotion; may struggle with maintaining a neutral face."
         },
         {
            "name":"No Prominent Marks (Controlled Expression)",
            "trait":"Suggests a more reserved and controlled emotional expression.",
            "pros":"Approaches life with caution; maintains privacy and a consistent demeanor.",
            "cons":"Can be perceived as aloof or emotionally distant; expression may seem guarded."
         },
         {
            "name":"Vertical Line between Brows (Stress/Discipline)",
            "trait":"The 'Suspicion Line'â€”indicates a disciplined, focused individual, but also suggests high mental pressure.",
            "pros":"Intense focus and discipline; capable of deep introspection and problem-solving.",
            "cons":"Highly prone to internalizing stress and worry; can struggle with relaxation."
         }
      ]
   },
   {
      "name":"Earlobe Size (Longevity & Character Foundation)",
      "key":"earlobes",
      "description":"Select the relative size and attachment of the earlobes (Longevity & Character Foundation).",
      "features":[
         {
            "name":"Large/Long Earlobe (Wisdom/Fortune)",
            "trait":"Often associated with great wisdom, excellent health, and long-term financial fortune.",
            "pros":"Kind, grounded, and generous personality; strong foundational character and health.",
            "cons":"Progress can be slow and methodical; sometimes resists modern or fast-paced changes."
         },
         {
            "name":"Small/Attached Earlobe (Practicality)",
            "trait":"Indicates a highly practical, down-to-earth, and self-reliant individual.",
            "pros":"Frugal, focused on immediate, concrete goals; highly self-reliant and hardworking.",
            "cons":"May lack foresight or broad vision; can be resistant to speculative ideas or dreams."
         },
         {
            "name":"Medium/Free Earlobe (Balanced Life)",
            "trait":"Suggests a balanced character, capable of adapting to change while maintaining stability.",
            "pros":"Good common sense; moderate approach to risk and high adaptability.",
            "cons":"May not achieve extremes in fortune or influence; comfortable with the middle path."
         }
      ]
   },
   {
      "name":"Jawline Definition (Willpower & Determination)",
      "key":"jawline",
      "description":"Select the shape and strength of the jawline (Willpower & Determination).",
      "features":[
         {
            "name":"Strong/Square Jaw (Determined)",
            "trait":"A sign of immense physical stamina, willpower, and leadership capability.",
            "pros":"Immense determination and stamina; natural leader who never gives up.",
            "cons":"Can be very stubborn, confrontational, and inflexible in their views."
         },
         {
            "name":"Narrow/Pointed Jaw (Intellectual)",
            "trait":"Suggests a person who relies more on mental agility than physical brute force.",
            "pros":"Flexible, highly intuitive, and mentally agile; thrives on intellectual pursuits.",
            "cons":"May lack raw physical stamina; can be seen as detached or overly intellectual."
         },
         {
            "name":"Round/Soft Jaw (Cooperative)",
            "trait":"Indicates a lover of peace, comfort, and good food.",
            "pros":"Excellent team player; values cooperation and harmonious relationships.",
            "cons":"May avoid necessary conflict; prone to prioritizing comfort over ambition or discipline."
         },
         {
            "name":"Receding Jaw (Flexibility/Dependence)",
            "trait":"Suggests a highly flexible and agreeable nature.",
            "pros":"Avoids confrontation and is highly agreeable; excellent at following direction.",
            "cons":"May struggle to maintain long-term goals without external support; can be perceived as lacking resolve."
         }
      ]
   },
   {
      "name":"Mouth Size (Social Energy & Appetite)",
      "key":"mouth_size",
      "description":"Select the relative size of the mouth (Social Energy & Appetite).",
      "features":[
         {
            "name":"Large Mouth (Extroverted/Ambitious)",
            "trait":"Indicates a high appetite for life, social interaction, and success.",
            "pros":"Charismatic, persuasive speaker; influences others easily; high social energy.",
            "cons":"Can be loud or attention-seeking; high risk of verbal over-commitment."
         },
         {
            "name":"Small Mouth (Introverted/Select)",
            "trait":"Suggests a person who is more private and selective.",
            "pros":"Choosy with friends, keeping a loyal inner circle; highly private and self-contained.",
            "cons":"Can appear standoffish or aloof; struggles in large, noisy social settings."
         },
         {
            "name":"Medium Mouth (Balanced)",
            "trait":"Represents a healthy balance between social output and private reflection.",
            "pros":"Navigates social situations well; balanced in appetite and ambition.",
            "cons":"May lack the dominant presence of a large mouth or the deep reserve of a small mouth."
         }
      ]
   },
   {
      "name":"Neck Length/Thickness (Resilience & Personal Power)",
      "key":"neck",
      "description":"Select the prominence and length of the neck (Resilience & Personal Power).",
      "features":[
         {
            "name":"Thick/Short Neck (Strong Will)",
            "trait":"Denotes high energy, physical resilience, and a strong, unyielding will.",
            "pros":"Highly determined and practical; great stamina for long, demanding projects.",
            "cons":"Can be overly stubborn or resistant to flexible thinking; prone to physical tension."
         },
         {
            "name":"Long/Slender Neck (Refined/Idealist)",
            "trait":"Associated with grace, refinement, idealism, and an intellectual focus.",
            "pros":"Appreciates aesthetic quality; highly intellectual, graceful, and sensitive.",
            "cons":"More sensitive to environment and stress; may lack raw physical endurance."
         },
         {
            "name":"Average Neck (Stable & Reliable)",
            "trait":"Suggests stability, reliability, and a steady temperament.",
            "pros":"Dependable and reliable; handles stress well; maintains a consistent pace.",
            "cons":"Rarely takes extreme risks or displays dominant charisma."
         }
      ]
   },
   {
      "name":"Teeth Alignment (Verbal Stamina & Openness)",
      "key":"teeth",
      "description":"Select the general condition and spacing of the front teeth (Verbal Stamina & Openness).",
      "features":[
         {
            "name":"Straight/Even Teeth (Integrity)",
            "trait":"Indicates high integrity, reliability, and a straightforward approach to communication.",
            "pros":"Perceived as trustworthy; speaks with confidence and clarity; reliable communicator.",
            "cons":"May be overly direct; can struggle with subtle, indirect communication."
         },
         {
            "name":"Gapped Teeth (Openness/Generosity)",
            "trait":"Associated with high communicative openness, generosity, and an abundance of life energy.",
            "pros":"Talkative, spontaneous, and embraces change easily; financial generosity.",
            "cons":"Can be prone to excessive gossip or sharing; may lack verbal filters."
         },
         {
         "name":"Overlapping/Crowded Teeth (Reserved)",
         "trait":"Suggests a more reserved or cautious nature, particularly in sharing personal information.",
         "pros":"Methodical and cautious; good at keeping secrets and maintaining privacy.",
         "cons":"Struggles to express opinions directly; communication may be unclear or hesitant."
         },
         {
            "name":"Large/Prominent Front Teeth (Verbal Impact)",
            "trait":"Indicates a person whose words carry significant weight and influence.",
            "pros":"High verbal energy and confidence; natural orator and expressive speaker.",
            "cons":"May dominate conversations; words can sometimes be perceived as overly forceful."
         }
      ]
   },
   {
      "name":"Hairline Shape (Maturity & Thinking Style)",
      "key":"hairline",
      "description":"Select the prominence and shape of the hairline (Maturity & Thinking Style).",
      "features":[
         {
            "name":"Straight/Receding Hairline (Practical Maturity)",
            "trait":"Associated with highly practical, systematic thinkers who gain wisdom early.",
            "pros":"Values structure and order; systematic and goal-oriented; achieves practical success.",
            "cons":"Can be overly focused on material goals; may lack spontaneous creativity."
         },
         {
            "name":"Rounded/Soft Hairline (Gentle Creativity)",
            "trait":"Suggests a gentle, sensitive, and artistic nature.",
            "pros":"High emotional intelligence; enjoys imaginative and nurturing pursuits; retains a youthful outlook.",
            "cons":"Can be overly sensitive to criticism; may lack the drive for rigid structure."
         },
         {
            "name":"Widow's Peak (Dramatic/Willful)",
            "trait":"Indicates a strong, determined, and sometimes dramatic personality.",
            "pros":"Highly driven by personal ambition; persuasive and strong-willed in their pursuits.",
            "cons":"Prone to drama and intensity; can become inflexible once a decision is made."
         },
         {
            "name":"M-Shaped Hairline (Artistic/Creative)",
            "trait":"Suggests a highly intelligent, creative, and analytical mind.",
            "pros":"Imaginative, analytical, and excels in strategic or artistic thinking.",
            "cons":"Mind can be restless; prone to over-analysis and jumping between projects."
         }
      ]
   },
   {
      "name":"Skin Texture (Energy & Sensitivity)",
      "key":"skin",
      "description":"Select the general appearance of the skin (Energy & Sensitivity).",
      "features":[
         {
            "name":"Smooth/Clear Skin (Inner Harmony)",
            "trait":"Suggests a balanced, calm internal state, good health, and a clear, consistent energy.",
            "pros":"Flows easily through challenges; calm and balanced demeanor; consistent energy levels.",
            "cons":"May lack the 'toughness' for high-pressure or physically demanding roles."
         },
         {
            "name":"Coarse/Rugged Skin (Resilience & Strength)",
            "trait":"Indicates a hardworking, resilient, and enduring nature.",
            "pros":"Highly capable of handling physical demands and external pressure; practical and tough.",
            "cons":"Can be resistant to refined or purely intellectual pursuits; may struggle with sensitivity."
         },
         {
            "name":"Rosy/Flushed Skin (Emotional Sensitivity)",
            "trait":"Associated with high emotional responsiveness, warmth, and an expressive nature.",
            "pros":"Warm, expressive, and highly responsive; wears feelings openly; good health vitality.",
            "cons":"Prone to stress or excitement; emotional states are easily visible to others."
         },
         {
            "name":"Oily/Shiny Skin (Active Metabolism/Emotion)",
            "trait":"Suggests an active metabolism and high emotional responsiveness.",
            "pros":"Energetic and passionate; quick to react and engage in activity.",
            "cons":"Can lead to emotional overdrive or mental restlessness; prone to quick bursts of energy rather than consistent output."
         }
      ]
   },
   {
      "name":"Forehead Lines (Life Experience & Intellect)",
      "key":"forehead_lines",
      "description":"Select the dominant pattern of horizontal lines (Life Experience & Intellect).",
      "features":[
         {
            "name":"Three Parallel Lines (The 'Ladder' of Success)",
            "trait":"Highly auspicious, suggesting intelligence, honor, and a steady climb to success.",
            "pros":"Disciplined and thoughtful; good fortune in career and public life; steady progress.",
            "cons":"Can be overly rigid in their pursuit of traditional success; may resist detours."
         },
         {
            "name":"Wavy/Broken Lines (Restless Mind)",
            "trait":"Suggests a restless, analytical mind that often jumps between ideas.",
            "pros":"Highly analytical and perceptive; experiences many life changes leading to broad wisdom.",
            "cons":"Struggles with consistent focus; prone to self-doubt or frequent career/life pivots."
         },
         {
            "name":"Few/No Lines (Calmness/Youth)",
            "trait":"Indicates a calm, perhaps youthful, and uncomplicated mental state.",
            "pros":"Takes things in stride; avoids excessive worry or deep mental turmoil; relaxed demeanor.",
            "cons":"May be perceived as naive or lacking deep insight; can be emotionally reserved."
         },
         {
            "name":"Single Deep Line (Stubbornness/Focus)",
            "trait":"A very pronounced single line suggests intense focus and great stubbornness or determination.",
            "pros":"Intense focus and determination; achieves success through sheer willpower.",
            "cons":"Extreme stubbornness; can be overly focused on one goal to the exclusion of others."
         }
      ]
   },
   {
      "name":"Space Between Eyebrows (Mental Clarity & Fortune - The Yintang)",
      "key":"yintang",
      "description":"Select the space/clearness of the area between the eyebrows (Mental Clarity & Fortune).",
      "features":[
         {
            "name":"Wide and Clear Space (Open Mind/Luck)",
            "trait":"Signifies an open-minded, optimistic, and highly intelligent nature.",
            "pros":"Attracts good fortune; maintains mental clarity; handles stress effectively; highly tolerant.",
            "cons":"Can be overly trusting or naive in certain circumstances."
         },
         {
            "name":"Narrow/Crowded Space (Intense Focus)",
            "trait":"Indicates deep intensity, high focus, and a tendency toward over-analysis or worry.",
            "pros":"Meticulous, dedicated, and capable of high concentration.",
            "cons":"Easily stressed or mentally blocked; prone to being judgmental or overly critical."
         },
         {
            "name":"Lines/Creases Present (Worry/Activity)",
            "trait":"Suggests frequent or intense mental activity, constant worry, or deep introspection.",
            "pros":"Highly expressive and thoughtful; deep capacity for problem-solving.",
            "cons":"Prone to worry and anxiety; requires conscious effort to relax and de-stress."
         }
      ]
   },
   {
      "name":"Wealth & Financial Fortune (Collection of Features)",
      "key":"wealth",
      "description":"Attributes related to financial stability, earning potential, and spending habits (Fortune & Career).",
      "features":[
         {
            "name":"Large Fleshy Nose Tip (The Wealthy Bulb)",
            "trait":"The best sign of wealth accumulation and generosity.",
            "pros":"High earning potential and an ability to hold onto money; successful later in life.",
            "cons":"Success may take longer to manifest; can be overly concerned with material comfort."
         },
         {
            "name":"Full and Plump Chin (Security & Land)",
            "trait":"Indicates longevity and security in later years.",
            "pros":"Stable financial foundation; reliable family support; prone to owning real estate.",
            "cons":"May become too comfortable or resistant to necessary life changes."
         },
         {
            "name":"High and Full Cheekbones (Social Power)",
            "trait":"Signifies a person who is highly influential and driven.",
            "pros":"Capable of managing large projects and teams; high-status income and respect.",
            "cons":"Can be perceived as overly ambitious or dominant; struggles with taking a supportive role."
         },
         {
            "name":"High Nasal Bridge (Ambition/Reach)",
            "trait":"A strong, high bridge of the nose suggests a person with high ambition.",
            "pros":"Excellent career luck; driven to reach important social and professional positions.",
            "cons":"Can set standards too high; prone to dissatisfaction if ambition is not immediately met."
         }
      ]
   },
   {
      "name":"Love & Relationship Harmony (Collection of Features)",
      "key":"love",
      "description":"Attributes related to partnership quality, romantic fortune, and marital happiness (Harmony & Sensitivity).",
      "features":[
         {
            "name":"Full and Symmetrical Lips (Emotional Generosity)",
            "trait":"The strongest sign of a nurturing, loving, and emotionally generous partner.",
            "pros":"Prioritizes relationships and family; offers great warmth and support.",
            "cons":"Can be overly invested in others' emotional states; prone to enabling."
         },
         {
            "name":"Clear, Smooth Skin around Eyes (Spouse Palace)",
            "trait":"The area just past the corner of the eyes (Spouse Palace) being smooth and clear.",
            "pros":"Indicates a stable, happy, and loyal relationship path; good marital harmony.",
            "cons":"Success in relationships is heavily dependent on maintaining personal clarity."
         },
         {
            "name":"Round Chin (Sociable/Harmonious)",
            "trait":"Associated with a kind, harmonious, and agreeable nature.",
            "pros":"Excellent at compromising and listening; seeks peace and stability in relationships.",
            "cons":"May avoid necessary conflicts to maintain harmony; struggles with strong opposition."
         },
         {
            "name":"Clear, Defined Philtrum (Fertility/Desire for Family)",
            "trait":"A well-defined Philtrum is strongly linked to vitality and a happy, fruitful family life.",
            "pros":"Strong desire for family; high vitality and clear influence on offspring.",
            "cons":"Focus on family may override other life goals or personal needs."
         }
      ]
   },
   {
      "name":"Warning Signs: Secrecy/Infidelity (Collection of Features)",
      "key":"deceit",
      "description":"Subtle attributes associated with secrecy, lack of forthrightness, and potential for emotional or financial cheating.",
      "features":[
         {
            "name":"Thin Lips (Reserved/Self-Serving)",
            "trait":"When combined with other traits, thin lips can suggest emotional reservation and self-interest.",
            "pros":"Highly independent and self-reliant in crisis.",
            "cons":"Emotional reservation; tendency to prioritize self-interest over partner's needs."
         },
         {
            "name":"Small, Shifty Eyes (Evasive/Secretive)",
            "trait":"Suggests a person who is secretive, cautious, and avoids direct confrontation.",
            "pros":"Highly cautious and excellent at discretion; maintains tight privacy.",
            "cons":"Lack of transparency; difficult to trust in personal or financial matters."
         },
         {
            "name":"Mouth That Turns Down (Pessimism/Discontent)",
            "trait":"Indicates chronic dissatisfaction or pessimism.",
            "pros":"Keeps expectations realistic; often highly self-critical and driven to improve.",
            "cons":"May seek fulfillment outside of existing commitments; chronic dissatisfaction can strain relationships."
         },
         {
            "name":"Narrow/Deep Set Eyes (Guarded/Suspicious)",
            "trait":"Suggests a person who is inherently guarded and skeptical of others' motives.",
            "pros":"Highly reserved with personal feelings and facts; very difficult to deceive.",
            "cons":"Difficult to get close to; skepticism can lead to missed opportunities or trust issues."
         }
      ]
   },
   {
      "name":"Communication & Voice (Expressive Style)",
      "key":"communication",
      "description":"Attributes related to how the person expresses themselves verbally and socially (Clarity & Influence).",
      "features":[
         {
            "name":"Long/Deep Philtrum (Fertility & Vitality)",
            "trait":"A clear, deep, and well-defined philtrum indicates excellent vitality and clear, influential communication skills.",
            "pros":"Strong health and vitality; clear and persuasive in speech; reliable communication.",
            "cons":"Can be overly traditional in their views on family/children."
         },
         {
            "name":"Thin/Shallow Philtrum (Lower Stamina)",
            "trait":"Associated with lower physical and verbal stamina.",
            "pros":"Prefers written or concise communication; avoids unnecessary public exposure.",
            "cons":"May speak softly or lack presence in public speaking; lower physical energy reserves."
         },
         {
            "name":"Mouth that Moves A Lot (Expressive)",
            "trait":"Suggests a person who is highly talkative, expressive, and uses their mouth to emphasize points.",
            "pros":"Dynamic and engaging communicator; easily expresses opinions and ideas.",
            "cons":"Can be prone to gossip or talking excessively; may struggle to listen actively."
         },
         {
            "name":"Clear Vertical Line Below Nose (Directness/Honesty)",
            "trait":"A distinct vertical line from the nose to the lip (part of the Philtrum) indicates honesty and directness in speech.",
            "pros":"Reliable, honest, and direct communicator; speaks with integrity.",
            "cons":"May lack tact; directness can sometimes be perceived as bluntness."
         }
      ]
   },
   {
      "name":"Health & Life Force (Stamina & Life Path)",
      "key":"vitality",
      "description":"Attributes indicating the person's physical energy, resilience, and general health (Stamina & Life Path).",
      "features":[
         {
            "name":"Fleshy/Full Cheeks (Strong Reserves)",
            "trait":"Indicates a person with strong internal reserves of energy (Qi), good health, and an ability to weather life's stresses.",
            "pros":"Strong internal reserves; long and stable life path; can weather major stresses.",
            "cons":"Can become overly comfortable; may over-indulge in food or comfort."
         },
         {
            "name":"Defined, Long Chin (Long Life Endurance)",
            "trait":"A long, well-defined chin is a classic sign of strong endurance and good health into old age.",
            "pros":"High physical and mental endurance; persists through long-term challenges.",
            "cons":"Can be stubborn; needs a long time to achieve goals, not suited for quick pivots."
         },
         {
            "name":"Sunken Eye Area (Lower Energy)",
            "trait":"Suggests that the person may be prone to fatigue, stress, or requires more rest.",
            "pros":"Highly sensitive and intuitive to subtle energies and changes.",
            "cons":"Lower energy reserves; requires consistent rest and stress management; prone to fatigue."
         },
         {
            "name":"Clear 'Life' Line from Nose (Longevity/Groundedness)",
            "trait":"A clear, long line running from the side of the nose toward the corner of the mouth (Nasolabial Fold) is a strong sign of health and longevity.",
            "pros":"Strong sign of long life and excellent groundedness; practical and hardworking.",
            "cons":"Can be overly focused on work and physical life; less prone to abstract thought."
         }
      ]
   },
   {
      "name":"Temperament & Reaction (Patience & Mood)",
      "key":"temperament",
      "description":"Attributes indicating the person's inherent emotional reactivity and general disposition (Patience & Mood).",
      "features":[
         {
            "name":"Thick/Coarse Eyebrows (Strong Temper)",
            "trait":"Associated with a strong, passionate, and sometimes impatient temperament.",
            "pros":"Highly energetic, decisive, and passionate in action; strong drive.",
            "cons":"Can be quick to anger or frustration; struggles with patience and tact."
         },
         {
            "name":"Light/Sparse Eyebrows (Gentle Spirit)",
            "trait":"Indicates a gentle, sensitive, and yielding personality.",
            "pros":"Quiet, reflective, and avoids conflict; prefers harmony and calm interactions.",
            "cons":"May struggle with assertiveness; prone to being easily led or influenced."
         },
         {
            "name":"Prominent Brow Bone (Assertive/Logical)",
            "trait":"Suggests a person who relies heavily on intellect and logic.",
            "pros":"Assertive in opinions; strong reliance on intellect and reason.",
            "cons":"Struggles with accepting purely emotional or subjective arguments; can appear dogmatic."
         },
         {
            "name":"Deep Vertical Lines Between Brows (Frustration/Pressure)",
            "trait":"Two deep vertical lines ('Suspension Bridge') indicate high mental pressure and intense concentration.",
            "pros":"Exceptional capacity for intense focus and concentration; highly goal-oriented.",
            "cons":"High tendency to internalize frustration and stress; difficulty relaxing the mind."
         }
      ]
   },
   {
      "name":"Reputation & Social Status (Public Image & Legacy)",
      "key":"reputation",
      "description":"Attributes related to public recognition, honor, and how the person is viewed by society (Public Image & Legacy).",
      "features":[
         {
            "name":"Fullness Above Eyebrows (Career/Status)",
            "trait":"A smooth, full area just above the eyebrows ('Official Seal') suggests a strong career trajectory.",
            "pros":"High honor and respected public status; strong support from superiors.",
            "cons":"Reputation is highly visible; prone to public scrutiny and expectation."
         },
         {
            "name":"Prominent, Clear Forehead (Good Legacy)",
            "trait":"A wide, clear, and high forehead indicates a good relationship with authorities, leading to promotion and a respected legacy.",
            "pros":"Respected legacy in their field; good fortune in youth and career advancement.",
            "cons":"Expectations for early success can be high; public image is critically important."
         },
         {
            "name":"Strong Back of Head (Support/Foundation)",
            "trait":"A strong, well-formed back of the head (occiput) suggests powerful foundational support from family or mentors.",
            "pros":"Excellent foundational support (family/mentors); assistance in public status climb.",
            "cons":"Relies on external foundation; struggles if support structure is removed."
         },
         {
            "name":"Well-Defined Nose Tip (Integrity/Trustworthiness)",
            "trait":"A clear, rounded nose tip with defined cartilage suggests strong personal integrity and consistency.",
            "pros":"Builds long-term public trust and reputation; high personal integrity.",
            "cons":"Reputation can be easily damaged by minor errors or perceived inconsistency."
         }
      ]
   },
   {
      "name":"Parental & Family Relations (Foundation & Ancestry)",
      "key":"family",
      "description":"Attributes indicating the quality of the person's relationship with their parents and family support structure (Foundation & Ancestry).",
      "features":[
         {
            "name":"Fullness at Hairline Corners (Sun & Moon)",
            "trait":"Fullness and clarity at the hairline corners indicate a loving, supportive relationship with both parents.",
            "pros":"Strong, loving, and supportive parental foundation; emotional security.",
            "cons":"May struggle with independence or separating from parental influence."
         },
         {
            "name":"Clear, Full Pouch Below Eyes (Children)",
            "trait":"The area directly under the eye is tied to one's children and future family.",
            "pros":"Suggests healthy, happy children and a strong, happy family life.",
            "cons":"Focus on family may become overwhelming; prone to worry about children's welfare."
         },
         {
            "name":"Eyebrows That Meet (Strong Family Focus)",
            "trait":"When the inner ends of the eyebrows touch or are very close, it indicates an intense focus on family.",
            "pros":"Intense loyalty to family; places family needs above their own.",
            "cons":"Can be overly protective or isolating; struggles to define personal boundaries outside the family unit."
         },
         {
            "name":"Fullness Under Outer Corner of the Eye (Support from Friends)",
            "trait":"This area relates to the extended network. Fullness here suggests strong support from close friends.",
            "pros":"Strong, supportive social network; wide, effective 'chosen family' circle.",
            "cons":"Success is highly dependent on social network; vulnerability to betrayal."
         }
      ]
   },
   {
      "name":"Pace of Life & Decision Making (Tempo & Action)",
      "key":"pace",
      "description":"Attributes related to the person's natural speed, rhythm, and method of processing information (Tempo & Action).",
      "features":[
         {
            "name":"Large Nostrils (Fast Pace/Spontaneous)",
            "trait":"Indicates a person who acts quickly, often spontaneously, and thrives on rapid changes.",
            "pros":"High energy and spontaneity; thrives in fast-paced, dynamic environments.",
            "cons":"Dislikes slow processes and planning; prone to impulsive decision-making."
         },
         {
            "name":"Small Mouth (Reserved/Methodical Pace)",
            "trait":"Suggests a methodical, slow, and reserved approach to life.",
            "pros":"Observes and plans extensively before action; ensures every step is secure and well-considered.",
            "cons":"Slow to adapt to rapid change; can miss time-sensitive opportunities."
         },
         {
            "name":"Horizontal Forehead Line (Steady Progress)",
            "trait":"A single, clear horizontal line across the forehead indicates a steady, determined, and continuous rhythm of progress.",
            "pros":"Steady, continuous progress throughout life; reliable and consistent performer.",
            "cons":"Not suited for dramatic, high-speed career pivots or spontaneous changes."
         },
         {
            "name":"Short Upper Lip (Impatience/Directness)",
            "trait":"A short space between the nose and upper lip suggests a lack of patience, leading to quick reactions.",
            "pros":"Direct and quick-thinking; acts or speaks without much delay; highly efficient.",
            "cons":"Lack of patience; prone to impulsive verbal or practical reactions."
         }
      ]
   },
   {
      "name":"Forehead Shape (Intellectual Capacity & Early Life)",
      "key":"forehead_shape",
      "description":"The shape and slope of the forehead, relating to intellect and the years 15-30.",
      "features":[
         {
            "name":"High and Rounded (Visionary/Idealist)",
            "trait":"Suggests a person with great vision, high intellect, and strong conceptual thinking.",
            "pros":"Strong conceptual and abstract thinking; excels in artistic or academic fields.",
            "cons":"Can be impractical; may struggle with day-to-day administration or concrete details."
         },
         {
            "name":"Low and Narrow (Practical/Worker)",
            "trait":"Indicates a practical, hands-on learner who excels in technical or administrative tasks.",
            "pros":"Thrives on concrete facts; excels at hands-on and technical learning; starts career early.",
            "cons":"May struggle with purely abstract or philosophical concepts."
         },
         {
            "name":"Sloping/Receding (Quick Thinker/Action-Oriented)",
            "trait":"Associated with people who think quickly on their feet and prefer action over contemplation.",
            "pros":"Highly entrepreneurial; quick-witted and action-oriented; excels in sales or quick decisions.",
            "cons":"Prone to making impulsive decisions; may lack patience for deep planning."
         },
         {
            "name":"Square/Broad (Structured/Authority)",
            "trait":"Suggests an organized, highly structured mind.",
            "pros":"Natural leaders and managers; excels in positions of authority and strategic planning.",
            "cons":"Can be overly rigid or bureaucratic; struggles with creative chaos."
         }
      ]
   },
   {
      "name":"Cheekbone Prominence (Authority & Social Drive)",
      "key":"cheekbones",
      "description":"The height and definition of the cheekbones (Influence & Ambition).",
      "features":[
         {
            "name":"High and Wide (Dominant/Leader)",
            "trait":"A person who naturally commands attention and authority.",
            "pros":"Driven, ambitious, and excels in leadership roles where influence is key; commands respect.",
            "cons":"Can be headstrong or overly dominant; may struggle to take a secondary role."
         },
         {
            "name":"Low/Flat (Cooperative/Supportive)",
            "trait":"Indicates a highly supportive and non-confrontational personality.",
            "pros":"Excellent team members; thrives in supportive or technical roles; highly cooperative.",
            "cons":"May lack the ambition or drive to seek top-level leadership positions."
         },
         {
            "name":"Fleshy/Full (Wealthy Power)",
            "trait":"Suggests a comfortable life with steady income and influence that grows over time.",
            "pros":"Steady income and influence; power is based on financial stability and strong social connections.",
            "cons":"Can become overly focused on comfort and luxury; resistant to risk."
         }
      ]
   },
   {
      "name":"Lip Thickness (Emotional Generosity & Nurturing)",
      "key":"lip_thickness",
      "description":"The relative thickness of the upper and lower lips (Nurturing Ability & Communication).",
      "features":[
         {
            "name":"Full Upper and Lower Lips (Nurturing/Emotional)",
            "trait":"A classic sign of high emotional intelligence, warmth, and a deep desire to nurture others.",
            "pros":"Highly generous with emotions; excellent caregiver; prioritizes family and warmth.",
            "cons":"Can be overly emotional or prone to giving too much; less focused on self-reliance."
         },
         {
            "name":"Thin Upper and Lower Lips (Independent/Reserved)",
            "trait":"Indicates a strong sense of independence and self-reliance.",
            "pros":"Highly independent and self-reliant; rational and reserved with emotions.",
            "cons":"May be perceived as emotionally cold or aloof; struggles with deep emotional vulnerability."
         },
         {
            "name":"Full Lower Lip (Self-Pleasure/Materialism)",
            "trait":"Suggests a focus on personal pleasure, comfort, and material enjoyment.",
            "pros":"Enjoys luxury and comfort; prioritizes self-care and personal enjoyment; good appetite for life.",
            "cons":"Tendency toward materialism; may struggle with self-sacrifice for others."
         },
         {
            "name":"Full Upper Lip (Giving/Verbal Nurturing)",
            "trait":"Associated with being highly generous in speech and providing emotional support to others.",
            "pros":"Excellent caregivers and counselors who use words to comfort; verbally supportive.",
            "cons":"May rely too heavily on words over action; prone to gossiping or over-explaining."
         }
      ]
   },
   {
      "name":"Nose Bridge Shape (Career Path & Ambition)",
      "key":"nose_bridge",
      "description":"The shape and height of the nose bridge (Ambition & Professional Life).",
      "features":[
         {
            "name":"Straight/High Bridge (Steady Career)",
            "trait":"Indicates a steady, reliable career path marked by consistency and integrity.",
            "pros":"Rises steadily in their field; respected by colleagues and superiors; high integrity.",
            "cons":"Progress is often slow and methodical; lacks the drive for extreme risk or rapid change."
         },
         {
            "name":"Concave/Scooped Bridge (Creative/Adaptable)",
            "trait":"Suggests a more adaptable and creative personality.",
            "pros":"Highly perceptive and creative; finds success in flexible or artistic careers.",
            "cons":"Career path may lack structure or consistency; prone to making emotional decisions."
         },
         {
            "name":"Aquiline/Bumpy Bridge (Willful/Fighter)",
            "trait":"Associated with a powerful, competitive, and highly determined personality.",
            "pros":"Possesses immense willpower and entrepreneurial drive; succeeds by overcoming opposition.",
            "cons":"Highly competitive and confrontational; struggles to work under authority."
         },
         {
            "name":"Flat/Broad Bridge (Team Player/Community)",
            "trait":"Indicates a focus on community, family, and team success.",
            "pros":"Highly cooperative; succeeds best when working collaboratively; strong community focus.",
            "cons":"May struggle to take individual credit or lead independent projects."
         }
      ]
   },
   {
      "name":"Chin Shape (Later Life & Security)",
      "key":"chin_shape",
      "description":"The overall form of the chin (Later Life, Endurance, and Family Security).",
      "features":[
         {
            "name":"Square/Broad Chin (Longevity/Stubborn)",
            "trait":"A sign of a successful, stable later life and high physical endurance.",
            "pros":"Strong endurance and longevity; requires and creates solid foundations (financial/real estate).",
            "cons":"Very stubborn and resistant to change in later life; relies heavily on structure."
         },
         {
            "name":"Pointed/Narrow Chin (Agile/Flexible)",
            "trait":"Suggests an agile, intellectual, and adaptable nature.",
            "pros":"Highly flexible and adaptable in later life; relies on mental activity for security.",
            "cons":"May lack fixed long-term physical or financial security; prone to anxiety over future stability."
         },
         {
            "name":"Double Chin/Fullness (Comfort/Affluence)",
            "trait":"Slight fullness here is highly favorable, suggesting a life of comfort, good fortune, and financial affluence in old age.",
            "pros":"True sign of security, comfort, and financial ease in old age; a life of minimal hardship.",
            "cons":"May become complacent; prone to over-indulgence and physical lethargy."
         },
         {
            "name":"Cleft Chin (Sociable/Charismatic)",
            "trait":"Associated with a sociable, passionate, and charismatic personality.",
            "pros":"Attracts attention and social support; leads a rich, well-supported social life later on.",
            "cons":"Needs constant attention and validation; success is often tied to social perception."
         }
      ]
   },
   {
      "name":"Forehead Slope (Execution Style)",
      "key":"forehead_slope",
      "description":"The degree to which the forehead slopes back (Speed of Thought vs. Deliberation).",
      "features":[
         {
            "name":"Vertical/Straight Forehead (Deliberate/Analytical)",
            "trait":"Indicates a mind that requires time to process information logically and thoroughly before action.",
            "pros":"Highly analytical and thorough; decisions are well-researched and rarely impulsive.",
            "cons":"Slow to act; can miss opportunities that require quick, intuitive responses."
         },
         {
            "name":"Slightly Sloping Forehead (Balanced/Pragmatic)",
            "trait":"Represents a balance between quick action and thoughtful deliberation.",
            "pros":"Pragmatic; can switch between analysis and action as needed; highly effective under moderate pressure.",
            "cons":"Can be indecisive when faced with extremes of speed or complexity."
         },
         {
            "name":"Steeply Sloping Forehead (Instinctive/Fast-Action)",
            "trait":"Associated with a mind that processes information rapidly and instinctively, preferring immediate action.",
            "pros":"Extremely quick thinker; highly instinctive and entrepreneurial; thrives on immediate execution.",
            "cons":"Prone to making impulsive errors; dislikes detailed planning or slow processes."
         }
      ]
   },
   {
      "name":"Ear Position (Early Life/Obedience)",
      "key":"ear_position",
      "description":"The position of the ear in relation to the eyebrow (Obedience to Authority/Intellect).",
      "features":[
         {
            "name":"Ears Above Eyebrow (High Intellect/Dominant)",
            "trait":"Indicates high intelligence, strong intellect, and a tendency to set their own rules.",
            "pros":"Highly independent and intellectually dominant; natural leadership and foresight.",
            "cons":"Dislikes following established rules or authority; can be perceived as arrogant."
         },
         {
            "name":"Ears Level with Eye/Brow (Balanced/Respected)",
            "trait":"Represents a respected position; willing to listen to authority but capable of independent thought.",
            "pros":"Highly respected; listens well but maintains independence; balanced life path.",
            "cons":"May lack the extreme dominance or rebellion needed for revolutionary change."
         },
         {
            "name":"Ears Below Eye/Brow (Early Stresses/Listener)",
            "trait":"Suggests early life challenges or a nature more inclined to listen and follow.",
            "pros":"Excellent listener and cooperative team member; gains wisdom through experience and struggle.",
            "cons":"May struggle with authority; often faces challenges early in life or career."
         }
      ]
   },
   {
      "name":"Facial Symmetry (Inner Balance & Fortune)",
      "key":"symmetry",
      "description":"The overall symmetry of the facial features (Inner Balance & Fortune).",
      "features":[
         {
            "name":"High Symmetry (Calm/Good Fortune)",
            "trait":"Indicates a balanced, calm, and harmonious internal life, attracting consistent good fortune.",
            "pros":"Highly consistent in character; attracts ease and general good luck; inner harmony.",
            "cons":"Can be perceived as lacking unique 'flaws' or personality edges."
         },
         {
            "name":"Minor Asymmetry (Dynamic/Adaptable)",
            "trait":"Suggests a dynamic life path and an ability to adapt to differing demands (e.g., career vs. family).",
            "pros":"Highly adaptable; success in different areas of life (e.g., creative vs. analytical).",
            "cons":"Life can feel split or demanding; requires effort to manage two different 'sides' of the personality."
         },
         {
            "name":"Major Asymmetry (Struggles/Strong Will)",
            "trait":"Often results from major life events or a strong, sometimes rebellious, personality.",
            "pros":"High willpower and resilience; finds success by overcoming major personal struggles.",
            "cons":"Life path is often marked by struggle or difficulty; needs to work harder for balance."
         }
      ]
   }
];
        
        // Trait selection and state management (user-specific data)
        let selectedTraits = {}; // Key: trait_key, Value: {name: feature_name, trait: description, pros: pros, cons: cons}
        let isMobileView = window.innerWidth <= 768; // Initial check for mobile view

        // --- Utility Functions ---

        /**
         * Dynamically updates the visibility of the list and report panes based on 
         * mobile view state and the currently active view.
         * @param {string} view - 'list' or 'report'
         */
        function updateVisibility() {
            const listPane = document.getElementById('list-pane');
            const reportPane = document.getElementById('report-pane');
            const listViewClass = 'list-view-mobile-hidden';
            const reportViewClass = 'report-view-mobile-hidden';

            if (isMobileView) {
                if (listPane.classList.contains(listViewClass)) {
                    // Report is showing, List is hidden
                    listPane.style.display = 'none';
                    reportPane.style.display = 'block';
                } else {
                    // List is showing, Report is hidden
                    listPane.style.display = 'block';
                    reportPane.style.display = 'none';
                }
            } else {
                // Desktop: always show both
                listPane.style.display = 'block';
                reportPane.style.display = 'block';
            }
        }

        /**
         * Changes the active view on mobile.
         * @param {string} newView - 'list' or 'report'
         */
        function changeView(newView) {
            const listPane = document.getElementById('list-pane');
            const reportPane = document.getElementById('report-pane');
            const listViewClass = 'list-view-mobile-hidden';
            const reportViewClass = 'report-view-mobile-hidden';

            if (newView === 'report') {
                listPane.classList.add(listViewClass);
                reportPane.classList.remove(reportViewClass);
            } else {
                listPane.classList.remove(listViewClass);
                reportPane.classList.add(reportViewClass);
            }
            updateVisibility();
        }

        /**
         * Checks screen size and updates the isMobileView state.
         */
        function checkScreenSize() {
            const wasMobile = isMobileView;
            isMobileView = window.innerWidth <= 768;
            
            // If we transition between desktop/mobile, ensure correct view is set.
            if (wasMobile !== isMobileView) {
                // Reset views to default on desktop transition
                if (!isMobileView) {
                    document.getElementById('list-pane').classList.remove('list-view-mobile-hidden');
                    document.getElementById('report-pane').classList.remove('report-view-mobile-hidden');
                }
                updateVisibility();
            }
        }

        /**
         * Renders the list of traits to the UI.
         */
        function loadTraits() {
            const listContainer = document.getElementById('trait-list');
            listContainer.innerHTML = ''; // Clear existing content

            TRAIT_DATA.forEach(traitCategory => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200';
                categoryDiv.innerHTML = `
                    <h3 class="text-lg font-bold text-red-600 mb-2">${traitCategory.name}</h3>
                    <p class="text-sm text-gray-500 mb-3">${traitCategory.description}</p>
                    <div id="features-${traitCategory.key}" class="space-y-2">
                        <!-- Features go here -->
                    </div>
                `;
                listContainer.appendChild(categoryDiv);

                const featuresContainer = categoryDiv.querySelector(`#features-${traitCategory.key}`);

                traitCategory.features.forEach(feature => {
                    const featureButton = document.createElement('button');
                    featureButton.type = 'button';
                    featureButton.dataset.key = traitCategory.key;
                    featureButton.dataset.name = feature.name;
                    featureButton.className = 'w-full text-left p-3 text-sm bg-white border border-gray-300 rounded-lg hover:bg-red-50 transition duration-100 ease-in-out shadow-sm';
                    featureButton.textContent = feature.name;

                    // Add click listener
                    featureButton.addEventListener('click', () => handleTraitSelection(traitCategory.key, feature, featureButton));
                    featuresContainer.appendChild(featureButton);
                });
            });

            // Initial check and setup
            checkScreenSize();
            updateVisibility();
        }

        /**
         * Handles the selection of a feature, updating state and UI.
         * @param {string} key - The category key (e.g., 'eye_shape')
         * @param {object} feature - The selected feature object
         * @param {HTMLElement} clickedButton - The button element that was clicked
         */
        function handleTraitSelection(key, feature, clickedButton) {
            // 1. Update internal state
            selectedTraits[key] = feature;

            // 2. Update UI for all buttons in that category
            const featuresContainer = document.getElementById(`features-${key}`);
            featuresContainer.querySelectorAll('button').forEach(btn => {
                if (btn === clickedButton) {
                    btn.classList.add('active-trait-item');
                    btn.classList.remove('bg-white', 'border-gray-300', 'hover:bg-red-50');
                } else {
                    btn.classList.remove('active-trait-item');
                    btn.classList.add('bg-white', 'border-gray-300', 'hover:bg-red-50');
                }
            });
            
            // 3. Update status message
            const allSelected = TRAIT_DATA.every(trait => selectedTraits[trait.key]);
            const statusMessage = document.getElementById('selection-status');
            if (allSelected) {
                statusMessage.classList.add('hidden');
            } else {
                // Keep status hidden until user tries to generate report without full selection
            }
        }

        /**
         * Generates and displays the final report.
         */
        function generateReport() {
            const requiredCount = TRAIT_DATA.length;
            const selectedCount = Object.keys(selectedTraits).length;
            const statusMessage = document.getElementById('selection-status');

            if (selectedCount < requiredCount) {
                statusMessage.classList.remove('hidden');
                // Brief message box instead of alert()
                const reportContent = document.getElementById('report-content');
                reportContent.innerHTML = `
                    <div class="p-6 bg-yellow-100 border border-yellow-400 rounded-xl shadow-md">
                        <p class="font-bold text-yellow-700">Incomplete Selection</p>
                        <p class="text-sm text-yellow-600">Please select one feature for all ${requiredCount} trait categories. You have selected ${selectedCount}.</p>
                    </div>
                `;
                changeView('report'); // Switch to report view to show the error on mobile
                updateVisibility();
                return;
            }

            statusMessage.classList.add('hidden'); // Hide status message on success

            // --- Report Logic ---
            const allPros = [];
            const allCons = [];
            const relationshipSummary = [];
            const financialSummary = [];
            const longevitySummary = [];

            for (const key in selectedTraits) {
                const feature = selectedTraits[key];
                
                // Collect pros and cons
                allPros.push(feature.pros);
                allCons.push(feature.cons);

                // Group-specific summaries
                if (key === 'love' || key === 'deceit') {
                    relationshipSummary.push(feature.name.replace(/ \(.*/, '')); // Use feature name without parenthesis
                }
                if (key === 'nostril_shape' || key === 'wealth') {
                    financialSummary.push(feature.name.replace(/ \(.*/, ''));
                }
                if (key === 'earlobes' || key === 'vitality' || key === 'jawline') {
                    longevitySummary.push(feature.name.replace(/ \(.*/, ''));
                }
            }

            // Create the Report HTML
            let reportHtml = `
                <div class="p-6 bg-red-600 text-white rounded-xl shadow-xl mb-6">
                    <h3 class="text-2xl font-bold">Your Comprehensive Trait Profile</h3>
                    <p class="text-sm mt-1 opacity-90">Based on your selections across ${requiredCount} major facial areas.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Pros Card -->
                    <div class="p-5 bg-green-50 rounded-xl border border-green-200 shadow-md">
                        <h4 class="text-xl font-bold text-green-700 mb-3">Strengths & Potential (<span class="font-mono text-green-900">${allPros.length} Total</span>)</h4>
                        <ul class="list-disc list-inside text-sm space-y-2">
                            ${allPros.map(p => `<li class="text-gray-700">${p}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <!-- Cons Card -->
                    <div class="p-5 bg-red-50 rounded-xl border border-red-200 shadow-md">
                        <h4 class="text-xl font-bold text-red-700 mb-3">Challenges & Areas for Growth (<span class="font-mono text-red-900">${allCons.length} Total</span>)</h4>
                        <ul class="list-disc list-inside text-sm space-y-2">
                            ${allCons.map(c => `<li class="text-gray-700">${c}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <h4 class="text-xl font-bold text-gray-700 mt-8 mb-4 border-b pb-2">Key Areas Focus</h4>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                    <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                        <p class="font-bold text-blue-700">Relationship Focus:</p>
                        <p>${relationshipSummary.length > 0 ? relationshipSummary.join(' and ') + '.' : 'No strong relationship features detected.'}</p>
                    </div>
                    <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                        <p class="font-bold text-green-700">Financial Tendency:</p>
                        <p>${financialSummary.length > 0 ? financialSummary.join(' and ') + '.' : 'No strong financial tendencies detected.'}</p>
                    </div>
                    <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                        <p class="font-bold text-red-700">Longevity/Endurance Focus:</p>
                        <p>${longevitySummary.length > 0 ? longevitySummary.join(' and ') + '. Requires attention to long-term stability.' : 'Focus on agile action and stability.'}</p>
                    </div>
                </div>
            `;

            document.getElementById('report-content').innerHTML = reportHtml;
            changeView('report'); // Switch to the report view
            updateVisibility();
        }

        // Event listeners
        
        // Report button click
        document.getElementById('generate-report-button').addEventListener('click', generateReport);

        // Back button click (Mobile Only)
        document.getElementById('back-button').addEventListener('click', () => {
            changeView('list');
        });

        // Add event listener for screen resize to handle changes between mobile/desktop viewports
        window.addEventListener('resize', checkScreenSize);


        // Initialize the application when the window loads
        window.onload = loadTraits;

    </script>
</body>
</html>
